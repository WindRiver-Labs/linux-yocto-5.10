// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright 2019-2020 NXP
 */

/dts-v1/;

#include <dt-bindings/usb/pd.h>
#include "imx8mm-evk.dtsi"

/ {
	model = "FSL i.MX8MM EVK board";
	compatible = "fsl,imx8mm-evk", "fsl,imx8mm";

	reserved-memory {
	#address-cells = <2>;
	#size-cells = <2>;
		ranges;

		rpmsg_reserved: rpmsg@0xb8000000 {
			no-map;
			reg = <0 0xb8000000 0 0x400000>;
		};
	};

	aliases {
		spi0 = &flexspi;
	};

	reg_sd1_vmmc: sd1_regulator {
                compatible = "regulator-fixed";
                regulator-name = "WLAN_EN";
                regulator-min-microvolt = <3300000>;
                regulator-max-microvolt = <3300000>;
                gpio = <&gpio2 10 GPIO_ACTIVE_HIGH>;
		off-on-delay-us = <20000>;
                startup-delay-us = <100>;
                enable-active-high;
        };
};

&ddrc {
	operating-points-v2 = <&ddrc_opp_table>;

	ddrc_opp_table: opp-table {
		compatible = "operating-points-v2";

		opp-25M {
			opp-hz = /bits/ 64 <25000000>;
		};

		opp-100M {
			opp-hz = /bits/ 64 <100000000>;
		};

		opp-750M {
			opp-hz = /bits/ 64 <750000000>;
		};
	};
};

&flexspi {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_flexspi>;
	status = "okay";

	flash@0 {
		reg = <0>;
		#address-cells = <1>;
		#size-cells = <1>;
		compatible = "jedec,spi-nor";
		spi-max-frequency = <80000000>;
		spi-tx-bus-width = <4>;
		spi-rx-bus-width = <4>;
	};
};

&sai2 {
       #sound-dai-cells = <0>;
       pinctrl-names = "default";
       pinctrl-0 = <&pinctrl_sai2>;
       assigned-clocks = <&clk IMX8MM_CLK_SAI2>;
       assigned-clock-parents = <&clk IMX8MM_AUDIO_PLL1_OUT>;
       assigned-clock-rates = <24576000>;
       status = "okay";
};

&usdhc1 {
	pinctrl-names = "default", "state_100mhz", "state_200mhz";
	pinctrl-0 = <&pinctrl_usdhc1>, <&pinctrl_usdhc1_gpio>;
	pinctrl-1 = <&pinctrl_usdhc1_100mhz>, <&pinctrl_usdhc1_gpio>;
	pinctrl-2 = <&pinctrl_usdhc1_200mhz>, <&pinctrl_usdhc1_gpio>;
	bus-width = <4>;
	vmmc-supply = <&reg_sd1_vmmc>;
	pm-ignore-notify;
	keep-power-in-suspend;
	non-removable;
	status = "okay";
};

&usdhc3 {
	assigned-clocks = <&clk IMX8MM_CLK_USDHC3_ROOT>;
	assigned-clock-rates = <400000000>;
	pinctrl-names = "default", "state_100mhz", "state_200mhz";
	pinctrl-0 = <&pinctrl_usdhc3>;
	pinctrl-1 = <&pinctrl_usdhc3_100mhz>;
	pinctrl-2 = <&pinctrl_usdhc3_200mhz>;
	bus-width = <8>;
	non-removable;
	status = "okay";
};

&csi1_bridge {
        fsl,mipi-mode;
        status = "okay";
        port {
                csi1_ep: endpoint {
                        remote-endpoint = <&csi1_mipi_ep>;
                };
        };
};

&i2c3 {
        clock-frequency = <100000>;
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_i2c3>;
        status = "okay";

        pca6416: gpio@20 {
                compatible = "ti,tca6416";
                reg = <0x20>;
                gpio-controller;
                #gpio-cells = <2>;
                vcc-supply = <&buck4_reg>;
        };

	bt_sco_codec: bt_sco_codec {
                #sound-dai-cells = <0>;
                compatible = "linux,bt-sco";
        };

        sound-bt-sco {
                compatible = "simple-audio-card";
                simple-audio-card,name = "bt-sco-audio";
                simple-audio-card,format = "i2s";
                simple-audio-card,bitclock-inversion;
                simple-audio-card,frame-master = <&btcpu>;
                simple-audio-card,bitclock-master = <&btcpu>;

                btcpu: simple-audio-card,cpu {
                        sound-dai = <&sai2>;
                        dai-tdm-slot-num = <2>;
                        dai-tdm-slot-width = <16>;
                };

                simple-audio-card,codec {
                        sound-dai = <&bt_sco_codec>;
                };
        };

	sound-wm8524 {
                compatible = "simple-audio-card";
                simple-audio-card,name = "wm8524-audio";
                simple-audio-card,format = "i2s";
                simple-audio-card,frame-master = <&cpudai>;
                simple-audio-card,bitclock-master = <&cpudai>;
                simple-audio-card,widgets =
                        "Line", "Left Line Out Jack",
                        "Line", "Right Line Out Jack";
                simple-audio-card,routing =
                        "Left Line Out Jack", "LINEVOUTL",
                        "Right Line Out Jack", "LINEVOUTR";

                cpudai: simple-audio-card,cpu {
                        sound-dai = <&sai3>;
                        dai-tdm-slot-num = <2>;
                        dai-tdm-slot-width = <32>;
                };

                simple-audio-card,codec {
                        sound-dai = <&wm8524>;
                        clocks = <&clk IMX8MM_CLK_SAI3_ROOT>;
                };
        };

        ak4458_1: ak4458@10 {
                compatible = "asahi-kasei,ak4458";
                reg = <0x10>;
                AVDD-supply = <&reg_audio_board>;
                DVDD-supply = <&reg_audio_board>;
        };

        ak4458_2: ak4458@12 {
                compatible = "asahi-kasei,ak4458";
                reg = <0x12>;
                AVDD-supply = <&reg_audio_board>;
                DVDD-supply = <&reg_audio_board>;
        };

        ak5558: ak5558@13 {
                compatible = "asahi-kasei,ak5558";
                reg = <0x13>;
                ak5558,pdn-gpio = <&pca6416 3 GPIO_ACTIVE_HIGH>;
                AVDD-supply = <&reg_audio_board>;
                DVDD-supply = <&reg_audio_board>;
        };

        ak4497: ak4497@11 {
                compatible = "asahi-kasei,ak4497";
                reg = <0x11>;
                ak4497,pdn-gpio = <&pca6416 5 GPIO_ACTIVE_HIGH>;
                AVDD-supply = <&reg_audio_board>;
                DVDD-supply = <&reg_audio_board>;
        };

	ov5640_mipi: ov5640_mipi@3c {
                compatible = "ovti,ov5640_mipi";
                reg = <0x3c>;
                status = "okay";
                pinctrl-names = "default";
                pinctrl-0 = <&pinctrl_csi_pwn>, <&pinctrl_csi_rst>;
                clocks = <&clk IMX8MM_CLK_CLKO1>;
                clock-names = "csi_mclk";
                assigned-clocks = <&clk IMX8MM_CLK_CLKO1>;
                assigned-clock-parents = <&clk IMX8MM_CLK_24M>;
                assigned-clock-rates = <24000000>;
                csi_id = <0>;
                pwn-gpios = <&gpio1 7 GPIO_ACTIVE_HIGH>;
                mclk = <24000000>;
                mclk_source = <0>;
                port {
                        ov5640_mipi1_ep: endpoint {
                                remote-endpoint = <&mipi1_sensor_ep>;
                        };
                };
        };
};

&iomuxc {
	pinctrl_sai2: sai2grp {
		fsl,pins = <
			MX8MM_IOMUXC_SAI2_TXC_SAI2_TX_BCLK      0xd6
			MX8MM_IOMUXC_SAI2_TXFS_SAI2_TX_SYNC     0xd6
			MX8MM_IOMUXC_SAI2_TXD0_SAI2_TX_DATA0    0xd6
			MX8MM_IOMUXC_SAI2_RXD0_SAI2_RX_DATA0    0xd6
		>;
	};

	pinctrl_csi_pwn: csi_pwn_grp {
                fsl,pins = <
                        MX8MM_IOMUXC_GPIO1_IO07_GPIO1_IO7               0x19
                >;
        };

        pinctrl_csi_rst: csi_rst_grp {
                fsl,pins = <
                        MX8MM_IOMUXC_GPIO1_IO06_GPIO1_IO6               0x19
                        MX8MM_IOMUXC_GPIO1_IO14_CCMSRCGPCMIX_CLKO1      0x59
                >;
        };

	pinctrl_flexspi: flexspigrp {
		fsl,pins = <
			MX8MM_IOMUXC_NAND_ALE_QSPI_A_SCLK               0x1c2
			MX8MM_IOMUXC_NAND_CE0_B_QSPI_A_SS0_B            0x82
			MX8MM_IOMUXC_NAND_DATA00_QSPI_A_DATA0           0x82
			MX8MM_IOMUXC_NAND_DATA01_QSPI_A_DATA1           0x82
			MX8MM_IOMUXC_NAND_DATA02_QSPI_A_DATA2           0x82
			MX8MM_IOMUXC_NAND_DATA03_QSPI_A_DATA3           0x82
		>;
	};

	pinctrl_i2c2: i2c2grp {
                fsl,pins = <
                        MX8MM_IOMUXC_I2C2_SCL_I2C2_SCL                  0x400001c3
                        MX8MM_IOMUXC_I2C2_SDA_I2C2_SDA                  0x400001c3
                >;
        };
	
	pinctrl_mipi_dsi_en: mipi_dsi_en {
                fsl,pins = <
                        MX8MM_IOMUXC_GPIO1_IO08_GPIO1_IO8               0x16
                >;
        };

	pinctrl_i2c2_synaptics_dsx_io: synaptics_dsx_iogrp {
                fsl,pins = <
                        MX8MM_IOMUXC_GPIO1_IO09_GPIO1_IO9               0x19    /* Touch int */
                >;
        };

	pinctrl_usdhc1_gpio: usdhc1grpgpio {
                fsl,pins = <
                        MX8MM_IOMUXC_SD1_RESET_B_GPIO2_IO10     0x41
                >;
        };

        pinctrl_usdhc1: usdhc1grp {
                fsl,pins = <
                        MX8MM_IOMUXC_SD1_CLK_USDHC1_CLK         0x190
                        MX8MM_IOMUXC_SD1_CMD_USDHC1_CMD         0x1d0
                        MX8MM_IOMUXC_SD1_DATA0_USDHC1_DATA0     0x1d0
                        MX8MM_IOMUXC_SD1_DATA1_USDHC1_DATA1     0x1d0
                        MX8MM_IOMUXC_SD1_DATA2_USDHC1_DATA2     0x1d0
                        MX8MM_IOMUXC_SD1_DATA3_USDHC1_DATA3     0x1d0
                >;
        };

        pinctrl_usdhc1_100mhz: usdhc1grp100mhz {
                fsl,pins = <
                        MX8MM_IOMUXC_SD1_CLK_USDHC1_CLK         0x194
                        MX8MM_IOMUXC_SD1_CMD_USDHC1_CMD         0x1d4
                        MX8MM_IOMUXC_SD1_DATA0_USDHC1_DATA0     0x1d4
                        MX8MM_IOMUXC_SD1_DATA1_USDHC1_DATA1     0x1d4
                        MX8MM_IOMUXC_SD1_DATA2_USDHC1_DATA2     0x1d4
                        MX8MM_IOMUXC_SD1_DATA3_USDHC1_DATA3     0x1d4
                >;
        };

        pinctrl_usdhc1_200mhz: usdhc1grp200mhz {
                fsl,pins = <
                        MX8MM_IOMUXC_SD1_CLK_USDHC1_CLK         0x196
                        MX8MM_IOMUXC_SD1_CMD_USDHC1_CMD         0x1d6
                        MX8MM_IOMUXC_SD1_DATA0_USDHC1_DATA0     0x1d6
                        MX8MM_IOMUXC_SD1_DATA1_USDHC1_DATA1     0x1d6
                        MX8MM_IOMUXC_SD1_DATA2_USDHC1_DATA2     0x1d6
                        MX8MM_IOMUXC_SD1_DATA3_USDHC1_DATA3     0x1d6
                >;
        };

	pinctrl_usdhc3: usdhc3grp {
		fsl,pins = <
			MX8MM_IOMUXC_NAND_WE_B_USDHC3_CLK               0x190
			MX8MM_IOMUXC_NAND_WP_B_USDHC3_CMD               0x1d0
			MX8MM_IOMUXC_NAND_DATA04_USDHC3_DATA0           0x1d0
			MX8MM_IOMUXC_NAND_DATA05_USDHC3_DATA1           0x1d0
			MX8MM_IOMUXC_NAND_DATA06_USDHC3_DATA2           0x1d0
			MX8MM_IOMUXC_NAND_DATA06_USDHC3_DATA2           0x1d0
			MX8MM_IOMUXC_NAND_DATA07_USDHC3_DATA3           0x1d0
			MX8MM_IOMUXC_NAND_RE_B_USDHC3_DATA4             0x1d0
			MX8MM_IOMUXC_NAND_CE2_B_USDHC3_DATA5            0x1d0
			MX8MM_IOMUXC_NAND_CE3_B_USDHC3_DATA6            0x1d0
			MX8MM_IOMUXC_NAND_CLE_USDHC3_DATA7              0x1d0
			MX8MM_IOMUXC_NAND_CE1_B_USDHC3_STROBE           0x190
		>;
	};

	pinctrl_usdhc3_100mhz: usdhc3-100mhzgrp {
		fsl,pins = <
			MX8MM_IOMUXC_NAND_WE_B_USDHC3_CLK               0x194
			MX8MM_IOMUXC_NAND_WP_B_USDHC3_CMD               0x1d4
			MX8MM_IOMUXC_NAND_DATA04_USDHC3_DATA0           0x1d4
			MX8MM_IOMUXC_NAND_DATA05_USDHC3_DATA1           0x1d4
			MX8MM_IOMUXC_NAND_DATA06_USDHC3_DATA2           0x1d4
			MX8MM_IOMUXC_NAND_DATA07_USDHC3_DATA3           0x1d4
			MX8MM_IOMUXC_NAND_RE_B_USDHC3_DATA4             0x1d4
			MX8MM_IOMUXC_NAND_CE2_B_USDHC3_DATA5            0x1d4
			MX8MM_IOMUXC_NAND_CE3_B_USDHC3_DATA6            0x1d4
			MX8MM_IOMUXC_NAND_CLE_USDHC3_DATA7              0x1d4
			MX8MM_IOMUXC_NAND_CE1_B_USDHC3_STROBE           0x194
		>;
	};

	pinctrl_usdhc3_200mhz: usdhc3-200mhzgrp {
		fsl,pins = <
			MX8MM_IOMUXC_NAND_WE_B_USDHC3_CLK               0x196
			MX8MM_IOMUXC_NAND_WP_B_USDHC3_CMD               0x1d6
			MX8MM_IOMUXC_NAND_DATA04_USDHC3_DATA0           0x1d6
			MX8MM_IOMUXC_NAND_DATA05_USDHC3_DATA1           0x1d6
			MX8MM_IOMUXC_NAND_DATA06_USDHC3_DATA2           0x1d6
			MX8MM_IOMUXC_NAND_DATA07_USDHC3_DATA3           0x1d6
			MX8MM_IOMUXC_NAND_RE_B_USDHC3_DATA4             0x1d6
			MX8MM_IOMUXC_NAND_CE2_B_USDHC3_DATA5            0x1d6
			MX8MM_IOMUXC_NAND_CE3_B_USDHC3_DATA6            0x1d6
			MX8MM_IOMUXC_NAND_CLE_USDHC3_DATA7              0x1d6
			MX8MM_IOMUXC_NAND_CE1_B_USDHC3_STROBE           0x196
		>;
	};
};

&i2c2 {
        clock-frequency = <400000>;
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_i2c2>;
        status = "okay";

        adv_bridge: adv7535@3d {
                compatible = "adi,adv7533";
                reg = <0x3d>;
                adi,addr-cec = <0x3b>;
                adi,dsi-lanes = <4>;
                pinctrl-names = "default";
                pinctrl-0 = <&pinctrl_i2c2_synaptics_dsx_io>;
                interrupt-parent = <&gpio1>;
                interrupts = <9 IRQ_TYPE_LEVEL_LOW>;
                status = "okay";

                port {
                        adv7535_from_dsim: endpoint {
                                remote-endpoint = <&dsim_to_adv7535>;
                        };
                };
        };

        ptn5110: tcpc@50 {
                compatible = "nxp,ptn5110";
                pinctrl-names = "default";
                pinctrl-0 = <&pinctrl_typec1>;
                reg = <0x50>;
                interrupt-parent = <&gpio2>;
                interrupts = <11 8>;
                status = "okay";

                port {
                        typec1_dr_sw: endpoint {
                                remote-endpoint = <&usb1_drd_sw>;
                        };
                };

                typec1_con: connector {
                        compatible = "usb-c-connector";
                        label = "USB-C";
                        power-role = "dual";
                        data-role = "dual";
                        try-power-role = "sink";
                        source-pdos = <PDO_FIXED(5000, 3000, PDO_FIXED_USB_COMM)>;
                        sink-pdos = <PDO_FIXED(5000, 3000, PDO_FIXED_USB_COMM)
                                     PDO_VAR(5000, 20000, 3000)>;
                        op-sink-microwatt = <15000000>;
                        self-powered;
                };
        };
};

&lcdif {
	status = "okay";
};

&mipi_csi_1 {
	#address-cells = <1>;
	#size-cells = <0>;
	status = "okay";
	port {
		mipi1_sensor_ep: endpoint@1 {
			remote-endpoint = <&ov5640_mipi1_ep>;
			data-lanes = <2>;
			csis-hs-settle = <13>;
			csis-clk-settle = <2>;
			csis-wclk;
		};

		csi1_mipi_ep: endpoint@2 {
			remote-endpoint = <&csi1_ep>;
		};
	};
};

&mipi_dsi {
	status = "okay";

	port@1 {
		dsim_to_adv7535: endpoint {
			remote-endpoint = <&adv7535_from_dsim>;
			attach-bridge;
		};
	};
};

&vpu_g1 {
	status = "okay";
};

&vpu_g2 {
	status = "okay";
};

&vpu_h1 {
	status = "okay";
};

&gpu {
	status = "okay";
};
